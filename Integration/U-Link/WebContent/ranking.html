<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Ranking</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-1.12.0.js"></script>
<script src="js/moment.js"></script>
<script src="js/bootstrap-datetimepicker.min.js"></script>
<script src="js/bootstrap-datetimepicker.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="http://www.w3schools.com/lib/w3data.js"></script>

<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

<script type="text/javascript">

$(document).ready(function() {
	
	$("#datepicker1").datepicker({ 
		dateFormat: 'yy/mm/dd' 
	});
	$("#datepicker2").datepicker({ 
		dateFormat: 'yy/mm/dd' 
	});
	
	$("#submit").click (
		function(){
			var criteria = $("#criteria").val();	
			
			var startDate = $("#datepicker1").val();
			
			var endDate = $("#datepicker2").val();
			var count = 0;
			var previous;
			var url="";
			var table = "<table>"
			if (criteria=="Doctor"){
					table += "<thead>"
							  +"<th>Ranking</th>"
							  +"<th>"+criteria+"</th>"
							  +"<th>Clinic</th>"
							  +"<th>Specialty</th>"
							  +"<th>Number of Appointments</th>"
						  +"</thead>";
					url="DisplayDoctorRanking";
			
		   }else if(criteria=="Referral"){
				table += "<thead>"
						  +"<th>Ranking</th>"
						  +"<th>Referred By</th>"
						  +"<th>Number of Referred Cases</th>"
				  	  +"</thead>";
				url="DisplayAllRankingReferredBy";
			
		   }else{//criteria== specialty
				table += "<thead>"
						  +"<th>Ranking</th>"
						  +"<th>"+criteria+"</th>"
						  +"<th>Number of Engagements</th>"
						  +"<th>List of Doctors</th>"
			  		  +"</thead>";
				url="DisplayAllRankingSpecialty";
		}				
			$.ajax({
			url : url,
			type : "get",
			data : 'startDate=' + startDate + '&' + 'endDate=' + endDate,
			dataType : "json",
			success : function(data) {
				var json = jQuery.parseJSON(JSON.stringify(data));	
				console.log(json)
				table += "<tbody>"
				$.each(json,function(key, value) {							
						if(previous != value){
							count += 1;	
						}
							table += "<tr>" 
								  +"<td>"+count+"</td>"
								  +"<td>"+value["name"]+"</td>"
								  +"<td>"+value["clinic"]+"</td>"
								  +"<td>"+value["speciality"]+"</td>"
								  +"<td>"+value["numAppointment"]+"</td>"	
								  +"</tr>"							
						});
				table += "</body></table>"
				$('#topK').html(table);  
			}
		});


	});
 	
});
 	</script>

</head>
<body>

<div w3-include-html="navBar.html"></div> 
	<script>
		w3IncludeHTML();
	</script>

	<div class="page-header">
		<h1 align="center">Ranking</h1>
	</div>

	<div class="container">
			<div class="form-group">
				<label>Select Criteria </label> <select class="form-control" id="criteria">
					<option value="Doctor">Doctor</option>
					<option value="Referral">Referral</option>
					<option value="Speciality">Specialty</option>
				</select>
			</div>

			<div class="form-group">
				<label> Select Start Date </label>
					 <input id="datepicker1" />
			</div>

			<div class="form-group">
				<label> Select End Date </label>
					 <input  id="datepicker2" />
			</div>
		
	</div>
	<div class="container" align="center">
		  <button type="submit" value="Submit" class="btn btn-primary" id="submit">Generate</button>
	</div>
		<br>
		<div class="container">

		<table class="table table-striped" id="topK">
		
		</table>
	</div>
</body>
</html>
