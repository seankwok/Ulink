<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/sb-admin.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <!-- jQuery -->
    <script src="js/jquery.js"></script>
    

    <!-- Bootstrap Core JavaScript -->
     <script src="js/bootstrap.min.js"></script>
    <script src="js/moment.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/bootstrap-datetimepicker.js"></script>
	
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

   <script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
   

 	<script type="text/javascript">
	
	$(document).ready(function() {
		getLoggedInUser();
		var user = "";
		
		$("#submit").click (
			function(){
							
				var startDate = $("#datepicker1").val();
				var endDate = $("#datepicker2").val();
				
				if(startDate=="" || endDate==""){
					$('#result').html("");
					$('#error').html("<div class='alert alert-danger' role='alert'><center><b> Enter Start and End Date. </b></center></div>");
				}else{
					$('#error').html("");
					checkDate(startDate,endDate);

				}

			});
	});
		
	function checkDate(startDate,endDate){
		var criteria = $("#criteria").val();
		var sendData = {
				"startDate" : startDate,
				"endDate":endDate,
		};
		$.ajax({
	    	url : "CompareDate",
			type : "get",
			data : sendData,
			success : function(data) {
				var json = jQuery.parseJSON(JSON.stringify(data));
					if(json == "false"){
						$('#error').html("<div class='alert alert-danger' role='alert'><center><b> Start Date should be earlier than End Date. </b></center></div>");
						$("#result").html("");
					}else{
							
						var count = 0;
						var previous;
						var url="";
						var table = "<table>"
						
						if (criteria=="Doctor"){
								table += "<thead>"
										  +"<th>Ranking</th>"
										  +"<th>"+criteria+"</th>"
										  +"<th>Clinic</th>"
										  +"<th>Specialty</th>"
										  +"<th>Number of Appointments</th>"
									  +"</thead>";
								url="DisplayDoctorRanking";
						
					   }else if(criteria=="Referral"){
							table += "<thead>"
									  +"<th>Ranking</th>"
									  +"<th>Referred By</th>"
									  +"<th>Number of Referred Cases</th>"
							  	  +"</thead>";
							url="DisplayAllRankingReferredBy";
						
					   }else{//criteria== specialty
							table += "<thead>"
									  +"<th>Ranking</th>"
									  +"<th>"+criteria+"</th>"
									  +"<th>Number of Engagements</th>"
									  +"<th>List of Doctors</th>"
						  		  +"</thead>";
							url="DisplayAllRankingSpecialty";
					}				
						$.ajax({
						url : url,
						type : "get",
						data : 'startDate=' + startDate + '&' + 'endDate=' + endDate,
						dataType : "json",
						success : function(data) {
							var json = jQuery.parseJSON(JSON.stringify(data));	
							table += "<tbody>"
							$.each(json,function(key, value) {
								
								if (criteria=="Doctor"){
									if(previous != value["numAppointment"]){
										count += 1;	
									}
									table += "<tr>" 
										  +"<td>"+count+"</td>"
										  +"<td>"+value["name"]+"</td>"
										  +"<td>"+value["clinic"]+"</td>"
										  +"<td>"+value["speciality"]+"</td>"
										  +"<td>"+value["numAppointment"]+"</td>"	
										  +"</tr>"	
										  
									  previous = value["numAppointment"];
									
								}else if(criteria=="Referral"){
									if(previous != value["count"]){
										count += 1;	
									}
									table += "<tr>" 
										  +"<td>"+count+"</td>"
										  +"<td>"+value["name"]+"</td>"
										  +"<td>"+value["count"]+"</td>"
										  +"</tr>"	
										  
									  previous = value["count"];
									
								}else{
									if(previous != value["count"]){
										count += 1;	
									}
									table += "<tr>" 
										  +"<td>"+count+"</td>"
										  +"<td>"+value["Specialty"]+"</td>"
										  +"<td>"+value["count"]+"</td>"
										  +"<td>"
										  	+"<a href='#' onClick=viewDoctors(this.id) id= '"
						    				+ value['Specialty']
						    				+ "'>View Doctors</a>"
										  +"</td>"
									  +"</tr>"	
									  	previous = value["count"];						
									}
								});
								table += "</body></table>"
								$("#clickedSpeciality").html("");
								$('#result').html(table);  
								$('#error').html(""); 									
							}
						});
					}
			}
		});
	}
	
	function viewDoctors(clickedID){
		var startDate = $("#datepicker1").val();
		var endDate = $("#datepicker2").val();
		

		var sendData = {
				"Specialty" :clickedID,
				"startDate" :startDate,
				"endDate" :	endDate
			};
		var speciality = "";
		var rank = 0;
		var prev ="";
		
		var table = "<table id='table' width='80%'>";
			$.ajax({
				url : "DisplayDoctorBySpecialty",
				type : "get",
				data : sendData ,
				dataType : "json",
				complete: function(data){
					var json = jQuery.parseJSON(data.responseText);
				    	table += "<thead>"
			    			+"<th>Ranking</th>"
			    			+"<th>Doctor</th>"
			    			+"<th>Number of Engagement</th>"
		    			+"</thead>";
		    			+ "<tbody>"
		    			$.each(json,function(key, value) {
			    		speciality = value["Specialty"]
			    		if(prev != value["engagement"]){
							rank += 1;	
						}
					table +="<tr>"
							  +"<td>"+rank+"</td>"
							  +"<td>"+value["name"]+"</td>"	 
							  +"<td>"+value["engagement"]+"</td>"
							+ "</tr>"
						prev = value["engagement"];
		    		});
		    		table += "</tbody></table>"
		    		$("#result").html(table);
		    		$("#clickedSpeciality").html("Speciality: "+clickedID);
				}	
			});
	}
	
	 function getLoggedInUser(){
	    	$.ajax({
				url : "DisplayLoginUser",
				type : "get",
				dataType : "json",
				complete : function(data) {
			    	var json = jQuery.parseJSON(JSON.stringify(data));
					user = json.responseText;
					document.getElementById('loggedInAs').innerHTML = user;
				}
	    	});
	    }
	    
	    function logout(){
			$.ajax({
				url: "Logout",
				type: "post",
				
			});
		}

 		

	   
	</script>
</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">ULink Reporting System</a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">
            	<li><a href="accountManagement.html"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> Account Management <b class="caret"></b></a></li>
                <li><a><i class="fa fa-user"></i> Logged in as: <p id='loggedInAs'></p> </a></li>
                <li><a href="login.html" onClick=logout()><span class="glyphicon glyphicon-off" aria-hidden="true"></span>   Logout</a></li>    
                
            </ul>
            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li class="active">
                        <a href="dashboard.html"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a>
                    </li>
                    <li>
                        <a href="client.html"><span class="glyphicon glyphicon-th-list" aria-hidden="true"></span> Client List</a>
                    </li>
                    <li>
                        <a href="javascript:;" data-toggle="collapse" data-target="#demo"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Screenings <i class="fa fa-fw fa-caret-down"></i></a>
                        <ul id="demo" class="collapse">
                            <li>
                                <a href="addScreeningAdult.html">Add New Screening</a>
                            </li>
                            <li>
                                <a href="viewScreeningsAdult.html">Recommend Screenings</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:;" data-toggle="collapse" data-target="#demo2"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Reports <i class="fa fa-fw fa-caret-down"></i></a>
                        <ul id="demo2" class="collapse">
                            <li>
                                <a href="genderAndAgeReport.html">Gender And Age Report</a>
                            </li>
                            <li>
                                <a href="reportIndex.html">Index (Points)</a>
                            </li>
                            <li>
                                <a href="kpi.html">Medical/ VISA KPI</a>
                            </li>
                            <li>
                                <a href="ranking.html">Ranking</a>
                            </li>
                           
                        </ul>
                    </li>
                    
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>

        <div id="page-wrapper">

            <div class="container-fluid">

			 <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">
                            <b>Report </b> <small>Ranking</small>
                             <button class="btn btn-primary pull-right" id="export"><b>Export this page</b></button>                         
                        </h1>
                        
                    </div>
                </div>

				<div class="row">
                    <div class="col-md-4">
			          <div class="caption">
			          <div class="form-group">
			               <label>Select Criteria </label> 
							<select class="form-control" id="criteria">
								<option value="Doctor">Doctor</option>
								<option value="Referral">Referral</option>
								<option value="Speciality">Specialty</option>
							</select>
			          </div>          
			          </div>
			          </div>
			
			          <div class="col-md-4">
			          <div class="caption">
			          <div class="form-group">
			          	 <label> Select Start Date </label><br>
						<input class="form-control" type="date" data-date-inline-picker="false" data-date-open-on-focus="true" id="datepicker1"/>	 
			          </div>          
			          </div>
			          </div>
			          
			          <div class="col-md-4">
			          <div class="caption">
			          <div class="form-group">
			          	 <label> Select End Date </label><br>
						<input class="form-control" type="date" data-date-inline-picker="false" data-date-open-on-focus="true" id="datepicker2"/>	 
			          </div>          
			          </div>
			          </div>
		         </div>
		         <div class="container" align="center">
			        <button type="submit" value="Submit" class="btn btn-primary" id="submit">Generate Results</button>
			    </div>
			    
			    <div class="container" align="left" id="table1"></div>
			  
			  	<div class="container" align="left" id="table2"></div>
			    </div>
				
				 <div class ='container' id='error'> </div> 
			
					
				
				<br>
			
				<div id='clickedSpeciality' class='subTitle'> </div>
				
				<br>
				
				<div class="container" >
					<table class="table table-striped" id="result"></table>
				</div>
					         
		         
			</div>
            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    
</body>

</html>
