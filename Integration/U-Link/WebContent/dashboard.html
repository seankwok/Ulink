<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <title>Dashboard</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">

    <script src="js/jquery-1.12.0.js"></script>
    
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script> 
	    $(function(){
	      $("#includedContent").load("navBar.html"); 
	    });
    </script> 
	
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	
 
 	<script type="text/javascript">
 	$(document).ready(function() {

	 	displayAllVisaType(); 	
	 	displayNumVisa();
	 	displayNumMedical();
	 	displayTopDocThisMonth();
	 	displayTopDocLastMonth();
	 	displayTopReferralThisMonth();
	 	displayTopReferralLastMonth();
	 	

 	});
 	

 	function displayAllVisaType(){
 		var type = [];
 		var numVisa = [];
			$.ajax({
				url: "DisplayAllVisaType",
				type: "get",
			    dataType : "json",
			    
			    complete: function(data){
			    	var json = jQuery.parseJSON(JSON.stringify(data));
			    	
			    	$.each(json.responseJSON,function(key, value) {
			    		type.push(key);
			    		numVisa.push(value);
			    		
			    	});
			    	
			    	Highcharts.chart('visaContainer', {
			     	    chart: {
			     	        type: 'bar'
			     	    },
			     	    title: {
			     	        text: 'Types of Visa Requested since Jun 2015'
			     	    },
			     	    
			     	    xAxis: {
			     	        categories: type,
			     	        title: {
			     	            text: null
			     	        }
			     	    },
			     	    yAxis: {
			     	        min: 0,
			     	        title: {
			     	            text: null,
			     	            align: 'high'
			     	        },
			     	        labels: {
			     	            overflow: 'justify'
			     	        }
			     	    },
			     	    tooltip: {
			     	        valueSuffix: ' clients'
			     	    },
			     	    plotOptions: {
			     	        bar: {
			     	            dataLabels: {
			     	                enabled: true
			     	            }
			     	        }
			     	    },
			     	    credits: {
			     	        enabled: false
			     	    },
			     	    series: [{
			     	        name: 'Number of Clients',
			     	        color:'#2E66BC',
			     	        data: numVisa
			     	    }]
			     	});
			    }	
			    
			});	
		}
 	
 	
 	function displayNumVisa(){
 		var month = [];
 		var num = [];
			$.ajax({
				url: "DisplayDashboardVisa",
				type: "get",
			    dataType : "json",
			    
			    complete: function(data){
			    	var json = jQuery.parseJSON(JSON.stringify(data));
			    	
			    	$.each(json.responseJSON,function(key, value) {
			    		month.push(key);
			    		num.push(value);
			    		console.log(key);
			    		
			    	});
			    	
			    	Highcharts.chart('numVisa', {
			    	    chart: {
			    	        type: 'column'
			    	    },
			    	    title: {
			    	        text: 'Number of VISA clients'
			    	    },
			    	    xAxis: {
			    	        categories:month,
			    	        crosshair: true
			    	    },
			    	    yAxis: {
			    	        min: 0,
			    	        title: {
			    	            text: 'Number of Clients'
			    	        }
			    	    },
			    	    tooltip: {
			    	        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
			    	        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
			    	            '<td style="padding:0"><b>{point.y:.1f} clients</b></td></tr>',
			    	        footerFormat: '</table>',
			    	        shared: true,
			    	        useHTML: true
			    	    },
			    	  
			    	    plotOptions: {
			    	        column: {
			    	            pointPadding: 0.2,
			    	            borderWidth: 0,
			    	            dataLabels: {
			     	                enabled: true
			     	            }
			    	        }
			    	    },
			    	    credits: {
			     	        enabled: false
			     	    },
			    	    series: [{
			    	    	name: 'Visa Clients',
			    	    	color:'#2758A1',
			    	    	data: num
			    	    }]
			    	});
			}
		});
	}
 	
 	function displayNumMedical(){
 		var month = [];
 		var num = [];
			$.ajax({
				url: "DisplayDashboardMedical",
				type: "get",
			    dataType : "json",
			    
			    complete: function(data){
			    	var json = jQuery.parseJSON(JSON.stringify(data));
			    	
			    	$.each(json.responseJSON,function(key, value) {
			    		month.push(key);
			    		num.push(value);
			    		
			    	});
			    	
			    	Highcharts.chart('numMedical', {
			    	    chart: {
			    	        type: 'column'
			    	    },
			    	    title: {
			    	        text: 'Number of Medical clients'
			    	    },
			    	    
			    	    xAxis: {
			    	        categories: month,
			    	        crosshair: true
			    	    },
			    	    credits: {
			     	        enabled: false
			     	    },
			    	    yAxis: {
			    	        min: 0,
			    	        title: {
			    	            text: 'Number of Clients'
			    	        }
			    	    },
			    	    tooltip: {
			    	        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
			    	        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
			    	            '<td style="padding:0"><b>{point.y:.1f} clients</b></td></tr>',
			    	        footerFormat: '</table>',
			    	        shared: true,
			    	        useHTML: true
			    	    },
			    	    plotOptions: {
			    	        column: {
			    	            pointPadding: 0.2,
			    	            borderWidth: 0,
			    	            dataLabels: {
			     	                enabled: true
			     	            }
			    	        }
			    	    },
			    	    series: [{
			    	    	name: 'Medical Clients',
			    	    	color:'#214986',
			    	    	data: num
			    	    }]
			    	
			    	   
			    	});
			}
		});
	}
 	
 	function displayTopDocThisMonth(){
 		var thisMonth;
 		$.ajax({
			url: "DisplayThisMonth",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		    	thisMonth = json.responseText;
		    	console.log(thisMonth);
		    }
 		}); 
 		
 		var thisMonthDoc = "<table id='thisMonthDoc'  class='table table-striped' cellspacing='0' width='100%'>";
 		
 		$.ajax({
			url: "DisplayAllLatestDoctorRankingDashboard",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		  		thisMonthDoc += "<h4><b>" + thisMonth +"</b></h4>"
		  		thisMonthDoc += "<tr><th>Rank</th>"
						  +  "<th>Doctor</th>"
						  +  "<th>Clinic</th>"
						  +  "<th>Speciality</th></tr>"
				$.each(json.responseJSON, function(key, value){
					thisMonthDoc += "<tbody><tr><td>"
	    				+ value["ranking"]
	    				+ "</td>"
	    				+ "<td>"
	    				+ value["name"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["clinic"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["speciality"]
    					+ "</td>"		    				
						+ "</td></tr></tbody>"
				});
				$('#thisMonthDoc').html(thisMonthDoc);		  
		    }
 		});
		    	
 	}
 	
 	function displayTopDocLastMonth(){
 		var lastMonth;
 		$.ajax({
			url: "DisplayLastMonth",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		    	lastMonth = json.responseText;
		    	console.log(lastMonth);
		    }
 		}); 
 		var lastMonthDoc = "<table id='lastMonthDoc'  class='table table-striped' cellspacing='0' width='100%'>";
 	
 		$.ajax({
			url: "DisplayAllPastDoctorRankingDashboard",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		  		lastMonthDoc += "<h4><b>" + lastMonth +"</b></h4>"
		  		lastMonthDoc += "<tr><th>Rank</th>"
							  +  "<th>Doctor</th>"
							  +  "<th>Clinic</th>"
							  +  "<th>Speciality</th></tr>"
							  $.each(json.responseJSON, function(key, value){
								  lastMonthDoc += "<tbody><tr><td>"
					    				+ value["ranking"]
					    				+ "</td>"
					    				+ "<td>"
					    				+ value["name"]
				    					+ "</td>"
				    					+ "<td>"
					    				+ value["clinic"]
				    					+ "</td>"
				    					+ "<td>"
					    				+ value["speciality"]
				    					+ "</td>"		    				
										+ "</td></tr></tbody>"
								});
				$('#lastMonthDoc').html(lastMonthDoc);
		    }
 		});
		    	
 	}
 	
 	function displayTopReferralThisMonth(){
 		var thisMonth;
 		$.ajax({
			url: "DisplayThisMonth",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		    	thisMonth = json.responseText;
		    	console.log(thisMonth);
		    }
 		}); 
 		var thisMonthRef = "<table id='thisMonthRef'  class='table table-striped' cellspacing='0' width='100%'>";
 		$.ajax({
			url: "DisplayAllLatestReferredbyDashboard",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		  		thisMonthRef += "<h4><b>" + thisMonth +"</b></h4>"
		  		thisMonthRef += "<tr><th>Rank</th>"
							  +  "<th>Referred By</th>"
							  +  "<th>Number of cases referred</th></tr>"
							  $.each(json.responseJSON, function(key, value){
								  thisMonthRef += "<tbody><tr><td>"
					    				+ value["ranking"]
					    				+ "</td>"
					    				+ "<td>"
					    				+ value["name"]
				    					+ "</td>"
				    					+ "<td>"
					    				+ value["count"]
				    					+ "</td>"		    				
										+ "</td></tr></tbody>"
								});
				 $('#thisMonthRef').html(thisMonthRef);
		    }
 		});
 	}
 	
 	function displayTopReferralLastMonth(){
 		var lastMonth;
 		$.ajax({
			url: "DisplayLastMonth",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		    	lastMonth = json.responseText;
		    	console.log(lastMonth);
		    }
 		}); 
 		var lastMonthRef = "<table id='lastMonthRef'  class='table table-striped' cellspacing='0' width='100%'>";
 		$.ajax({
			url: "DisplayAllPastReferredbyDashboard",
			type: "get",
		    dataType : "json",
		    complete: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		  		lastMonthRef += "<h4><b>" + lastMonth +"</b></h4>"
		  		lastMonthRef += "<tr><th>Rank</th>"
							  +  "<th>Referred By</th>"
							  +  "<th>Number of cases referred</th></tr>"
							  $.each(json.responseJSON, function(key, value){
								  lastMonthRef += "<tbody><tr><td>"
					    				+ value["ranking"]
					    				+ "</td>"
					    				+ "<td>"
					    				+ value["name"]
				    					+ "</td>"
				    					+ "<td>"
					    				+ value["count"]
				    					+ "</td>"		    				
										+ "</td></tr></tbody>"
								});
				$('#lastMonthRef').html(lastMonthRef);
		    }
 		});
 	}
 	
 	
 	
 	</script>
 	
</head>
<body>
  	<div id="includedContent"></div>

	<div class="container">
	<div class="col-md-4">
	
	<div id="visaContainer" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto"></div>
	
	</div>
	
	<div class="col-md-4">
	
	<div id="numVisa" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto"></div>
	
	</div>
	
	<div class="col-md-4">
	
	<div id="numMedical" style="min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto"></div>
	
	</div>
	
	</div>
	
	
	<div class="container" align="center">
		<h3><b><u>Top Doctors/ Referral Sources</u></b></h3>
		
	 <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo2">Click on this button to view for Doctors</button>
	  <div id="demo2" class="collapse">
		<div class="col-md-6" id="thisMonthDoc"></div>
		<div class="col-md-6" id="lastMonthDoc"></div>
	  </div>
	
	
	  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo4">Click on this button to view for Referral</button>
	  <div id="demo4" class="collapse">
	  <div class="col-md-6" id="thisMonthRef"></div>
		<div class="col-md-6" id="lastMonthRef"></div>
	  </div>
	
	
	
	</div>
	
	
	
</body>
</html>