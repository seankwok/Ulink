<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <title>View Screening - Adult</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery-1.12.0.js"></script>
	<script src="js/bootstrap.min.js"></script>
    <script> 
	    $(function(){
	      $("#includedContent").load("navBar.html"); 
	    });
    </script> 
    
	
 	
 	<style>
 	#myInput {
		    font-size: 16px; /* Increase font-size */
		    padding: 12px 20px 12px 40px; /* Add some padding */
		    border: 1px solid #ddd; /* Add a grey border */
		    margin-bottom: 12px; /* Add some space below the input */
		}
		
		#table{
		    border-collapse: collapse; /* Collapse borders */
		    width: 100%; /* Full-width */
		    font-size: 14px; /* Increase font-size */
		}
		
		#table th, #table td {
		    text-align: left; /* Left-align text */
		    padding: 10px; /* Add padding */
		    
		}
		
		#table tr:hover {background-color: #f5f5f5}

		#table tr {
		    /* Add a bottom border to all table rows */
		    border-bottom: 1px solid ; 
		     padding-bottom: 30px; /* Add padding */
		}
		
		#table tr.header, #table tr:hover {
		    /* Add background color to the table header and on hover */
		    font-color: black;
		     margin-bottom: 5px;
		}
		
		select{
			border: 0px;
			outline: 0px;
		}
		
		
		/* unvisited link */
	a:link {
	    text-decoration:none;
	}
	
	/* visited link */
	a:visited {
	    text-decoration:none;
	}
	
	/* mouse over link */
	a:hover {
	    text-decoration:none;
	}
	
	/* selected link */
	a:active {
	    text-decoration:none;
	}
	
	.inline {
	     display: inline-block;
	      margin: 10px;
	}
		
	
 	</style>
 	
 	
 	<script type="text/javascript">
 	var clients = [];
 	
 // Returns an array with values of the selected (checked) checkboxes in "frm"
 	function getSelectedChbox(frm) {
 	  var selchbox = [];       
 	  // array that will store the value of selected checkboxes

 	  // gets all the input tags in frm, and their number
 	  var inpfields = frm.getElementsByTagName('input');
 	  var nr_inpfields = inpfields.length;

 	  // traverse the inpfields elements, and adds the value of selected (checked) checkbox in selchbox
 	  for(var i=0; i<nr_inpfields; i++) {
 	    if(inpfields[i].type == 'checkbox' && inpfields[i].checked == true) selchbox.push(inpfields[i].value);
 	  }

 	  return selchbox;
 	}


 	
 	
	$(document).ready(function() {
		
		displayAll();
		$("#selectInfant").click(function(){
			window.location = "viewScreenings.html";
		});
		 $("#ckbCheckAll").click(function () {
		        $(".checkBoxClass").prop('checked', $(this).prop('checked'));
		  });

			
	});
	

	
	function jsFunction1(value){
		   // set search box value as gender
		   var txt =  document.getElementById('myInput');
		   txt.value = value;
		   document.getElementById('gender').value = '';
		   mySearch();
	}
	function mySearch() {
		  
		  var searchText = document.getElementById('myInput').value.toUpperCase();
		    var targetTable = document.getElementById('table');
		    var targetTableColCount;
		            
		    //Loop through table rows
		    for (var rowIndex = 0; rowIndex < targetTable.rows.length; rowIndex++) {
		        var rowData = '';

		        //Get column count from header row
		        if (rowIndex == 0) {
		           targetTableColCount = targetTable.rows.item(rowIndex).cells.length;
		           continue; //do not execute further code for header row.
		        }
		                
		        //Process data rows. (rowIndex >= 1)
		        for (var colIndex = 0; colIndex < targetTableColCount; colIndex++) {
		            rowData += targetTable.rows.item(rowIndex).cells.item(colIndex).textContent.toUpperCase();
		        }

		        //If search term is not found in row data
		        //then hide the row, else show
		        if (rowData.indexOf(searchText) == -1)
		            targetTable.rows.item(rowIndex).style.display = 'none';
		        else
		            targetTable.rows.item(rowIndex).style.display = 'table-row';
		    }
	}
 
		
	function deleteItem(clickedID){
			
			var sendData = {
					"ID" : clickedID
				};
				$.ajax({
					url : "DeleteCondition",
					type : "post",
					data : sendData,
					dataType : "json",
					success : function(data) {
						displayAll();
					}
	
				});
	    } 

	
	function editItem(clickedID){
		var sendData = {
				"ID" : clickedID
			};
			$.ajax({
				url : "EditCondition",
				type : "post",
				data : sendData,
				dataType : "json",
				complete : function(data) {
					displayAll();
						window.location="editTimelineSummary.html";
					
				}

			});
	}
	
	function sendEmail(){ 
		clients = $('input[name="selectClients"]:checked').map(function() {
		    return this.value;
		}).get();
		if (clients == ""){
			$('#message').html("<div class='alert alert-danger' role='alert'><center><b> Please select at least 1 checkbox. </b></center></div>");
		}else{
			
	    	$.ajax({
				type: 'post',
				url: "StoreSendEmail",
				data: 'email=' + clients,
				complete: function(data){		
			    		window.location.href = "draftEmail.html";	
				}
	    	
			    	
			});
		} 
	}
	

	
	function viewPatientList(clickedID){
		  var sendData = {
		    "ID" : clickedID
		   };
		  
		  var table = "<table id='table'  class='display' cellspacing='0' width='100%'>";
		     var condition="";
		     var screeningName="";
		     var type = "";
		   $.ajax({
		    url : "DisplayPatientsByIllness",
		    type : "get",
		    data : sendData,
		    dataType : "json",
		    complete: function(data){
		        var json = jQuery.parseJSON(data.responseText);
		        table += "<h3><b>Condition Name:</b>  " + json[0].conditionName +"<br>   <b>Screening Name: </b> "+ json[0].screeningName +"</h3>"
		        
		        table += "<thead><tr><th>Age</th><th>Client Name</th><th>Email</th><th>Email Sent Date</th><th>PIC</th>"
		        	+ "<th>Select   "+"<button type='button' class='btn btn-primary' id='ckbCheckAll'>Select all</button>" +"</th></tr></thead>";
		      
		        $.each(json,function(key,value) {
		        
		         
		          
		          table += "<tbody><tr><td>"
		          + value["age"]
		          + "</td>"
		          + "<td>"
		          + value["name"]
		          + "</td>"
		          + "<td>"
		          + value["email"]
		          + "</td>"
		          + "<td>"
		          + value["date"]
		          + "</td>"
		          + "<td>"
		          + value["followUpPerson"]
		          + "</td>"
		          + "<td>"
		          + "<input type='checkbox' class='checkBoxClass' name='selectClients' value=" + value["email"]+">"          
		       + "</td></tr></tbody>"
		        });
		        table += "</table>"
		        table += "<div id='displayNumSelected'></div>"
		        table += "<div class='container' align='center'>"
		         + "<div class='inline'><button class='btn btn-default' onclick='sendEmail()'>Go to email template</button></div><div class='inline'><div  id='message'></div></div>"
		         + "<br> <button type='button' id='export' class='btn btn-link'><b>Export to excel(in progress)</b></button>"
		           +"</div>"
		       
		         $("#display").html(table);
		        
		    } 
		     

		   });
		 }
	
	
	function displayAll(){
		var table = "<table id='table'  class='display' cellspacing='0' >";
		var isEmpty = false;
		$.ajax({
			url: "DisplayAll",
			type: "get",
		    dataType : "json",    
		    success: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		    	table += "<thead><tr><th>Starting Age<a href='#' onClick=sortAscAge(this.id) id='ageRequired'>&#9652</a>"
		    			+ "<a href='#' onClick=sortDescAge(this.id) id='ageRequired'> &#9662</a></th>"
		    			+ "<th>Common Illness<a href='#' onClick=sortAscIllness(this.id) id='conditionName'> &#9652</a>"
		    			+ "<a href='#' onClick=sortDescIllness(this.id) id='conditionName'> &#9662</a></th>"
		    			+ "<th>Screening <a href='#' onClick=sortAscScreening(this.id) id='screening'> &#9652</a>"
		    			+ "<a href='#' onClick=sortDescIllness(this.id) id='screening'> &#9662</a></th>"
		    			+"<th>"
			    		+"<select onchange='jsFunction1(value)' id='gender'>"
					    	+"<option value='Male' onclick='if (!document.getElementById('searchInput').onchange()) mySearch();'>Male</option>"
					    	+"<option value='Female'>Female</option>"
					    	+"<option value='' selected='selected' >All Gender Type</option>"
					    	+"</select>"
				    	+"</th>"
		    			+ "<th>Regularity of screening</th>"
		    			+ "<th>View Patients</th>"
		    			+ "<th>Edit</th>"
		    			+ "<th>Delete</th></tr></thead>";
		    	$.each(json,function(key, value) {
		    		table += "<tbody><tr><td>"
	    				+ value["ageRequired"]
	    				+ "</td>"
	    				+ "<td>"
	    				+ value["conditionName"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["screening"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["type"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["years"] 
    					+ "</td>"
    					+ "<td>"
	    				+"<a href='#' onClick=viewPatientList(this.id) id= '"
	    				+ value.ID
	    				+ "'>View patients</a>"
    					+ "</td>"
    					+ "<td>"
	    				+ "<a href='#' onClick=editItem(this.id) id= '"
	    				+ value.ID
	    				+ "'>Edit</a>"
    					+ "</td>"
    					+ '<td><a href=# onClick=deleteItem(this.id) id="'
						+ value.ID
						+ '">Delete</a></td></tr>'		    				
						+ "</td></tr></tbody>"
		    	});
		    	table += "</table>"
		    		$("#display").html(table);
		    	
		    }	
		    
		});	
		}
		


	
	
		
 </script>
  </head>
  
  <body>
    
  	<div id="includedContent"></div>

	<div class="page-header"  align="center">
	  <h1><b>View Screenings - Adult</b></h1>
	  <div class="row">
	  <button type="button" class="btn btn-default"> <a href='addScreeningAdult.html'> Add new screening</a></button>
	  <div class="container" align="right">
	   		<input type="text" id="myInput" onkeyup="mySearch()" placeholder="Search">
	   	</div>
	   	</div>
	</div>

	<div class="container">
	<div class="btn-group btn-group-justified" role="group">
	  <div class="btn-group" role="group">
	    <button type="button" id="selectInfant" class="btn btn-default"><b>Infants (0-24 months)</b></button>
	  </div>
	  <div class="btn-group" role="group">
	    <button type="button" id="selectAdult" class="btn btn-primary"><b>Adults (2 years and above)</b></button>
	  </div>
	</div>
	</div>

	
	
	
	<div class="container" id="display"></div>
	
	

  </body>
</html>
