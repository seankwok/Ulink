<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <title>View Screening - Adult</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery-1.12.0.js"></script>
	<script src="js/bootstrap.min.js"></script>
    <script> 
	    $(function(){
	      $("#includedContent").load("navBar.html"); 
	    });
    </script> 
    
	
 	
 	<style>
 	
		
		#table{
		    border-collapse: collapse; /* Collapse borders */
		    width: 100%; /* Full-width */
		    font-size: 14px; /* Increase font-size */
		}
		
		#table th, #table td {
		    text-align: left; /* Left-align text */
		    padding: 10px; /* Add padding */
		    
		}
		
		#table tr:hover {background-color: #f5f5f5}

		#table tr {
		    /* Add a bottom border to all table rows */
		    border-bottom: 1px solid ; 
		     padding-bottom: 30px; /* Add padding */
		}
		
		#table tr.header, #table tr:hover {
		    /* Add background color to the table header and on hover */
		    font-color: black;
		     margin-bottom: 5px;
		}
		
		select{
			border: 0px;
			outline: 0px;
		}
		
		
	
	
	.inline {
	     display: inline-block;
	      margin: 10px;
	}
		
	
 	</style>
 	
 	
 	<script type="text/javascript">
 	var clients = [];
 	
 
	$(document).ready(function() {
		
		displayAll();
		$("#selectInfant").click(function(){
			window.location = "viewScreenings.html";
		});
		 $("#ckbCheckAll").click(function () {
		        $(".checkBoxClass").prop('checked', $(this).prop('checked'));
		  });
		 $("#sort").click(function(){
			 $.ajax({
				    url : "",
				    type : "get",
				    dataType : "json",
				    complete: function(data){}
		 });
		 });
		 
		 
		 var search = "<div class='col-md-3'><form action='#' method='get'><div class='input-group'>"
             + "<input class='form-control' id='system-search' name='q' placeholder='Search for' required>"
             + "<span class='input-group-btn'><button class='btn btn-default'><i class='glyphicon glyphicon-search'></i></button>"
             + "</span></div></form></div>"

		$("#search").html(search);
             
             
          
		 var activeSystemClass = $('.list-group-item.active');

		    //something is entered in search form
		    $('#system-search').keyup( function() {
		       var that = this;
		        // affect all table rows on in systems table
		        var tableBody = $('.table-list-search tbody');
		        var tableRowsClass = $('.table-list-search tbody tr');
		        $('.search-sf').remove();
		        tableRowsClass.each( function(i, val) {
		        
		            //Lower text for case insensitive
		            var rowText = $(val).text().toLowerCase();
		            var inputText = $(that).val().toLowerCase();
		            if(inputText != ''){
		            }
		            else
		            {
		                $('.search-query-sf').remove();
		            }

		            if( rowText.indexOf( inputText ) == -1 )
		            {
		                //hide rows
		                tableRowsClass.eq(i).hide();
		                
		            }
		            else
		            {
		                $('.search-sf').remove();
		                tableRowsClass.eq(i).show();
		            }
		        });
		        //all tr elements are hidden
		        if(tableRowsClass.children(':visible').length == 0)
		        {
		            tableBody.append('<tr class="search-sf"><td class="text-muted" colspan="6">No entries found.</td></tr>');
		        }
		    });   
             
             
          
	});
	
		
	function deleteItem(clickedID){
			
			var sendData = {
					"ID" : clickedID
				};
				$.ajax({
					url : "DeleteCondition",
					type : "post",
					data : sendData,
					dataType : "json",
					success : function(data) {
						displayAll();
					}
	
				});
	    } 

	
	function editItem(clickedID){
		var sendData = {
				"ID" : clickedID
			};
			$.ajax({
				url : "EditCondition",
				type : "post",
				data : sendData,
				dataType : "json",
				complete : function(data) {
					displayAll();
						window.location="editTimelineSummary.html";
					
				}

			});
	}
	
	function sendEmail(){ 
		clients = $('input[name="selectClients"]:checked').map(function() {
		    return this.value;
		}).get();
		if (clients == ""){
			$('#message').html("<div class='alert alert-danger' role='alert'><center><b> Please select at least 1 checkbox. </b></center></div>");
		}else{
			
	    	$.ajax({
				type: 'post',
				url: "StoreSendEmail",
				data: 'email=' + clients,
				complete: function(data){		
			    		window.location.href = "draftEmail.html";	
				}
	    	
			    	
			});
		} 
	}
	

	
	function viewPatientList(clickedID){
		  var sendData = {
		    "ID" : clickedID
		   };
		  
		  var table = "<table id='table'  class='display' cellspacing='0' width='100%'>";
		     var condition="";
		     var screeningName="";
		     var type = "";
		   $.ajax({
		    url : "DisplayPatientsByIllness",
		    type : "get",
		    data : sendData,
		    dataType : "json",
		    complete: function(data){
		        var json = jQuery.parseJSON(data.responseText);
		        console.log(json);
		        table += "<h3><b>Condition Name:</b>  " + json[0].conditionName +"<br>   <b>Screening Name: </b> "+ json[0].screeningName +"</h3>"
		        
		        table += "<thead><tr><th>Age</th><th>Client Name</th><th>Email</th><th>Email Sent Date</th><th>PIC</th>"
		        	+ "<th>Select</th></tr></thead>";
		      
		        $.each(json,function(key,value) {
		        
		          table += "<tbody><tr><td>"
		          + value["age"]
		          + "</td>"
		          + "<td>"
		          + value["name"]
		          + "</td>"
		          + "<td>"
		          + value["email"]
		          + "</td>"
		          + "<td>"
		          + value["date"]
		          + "</td>"
		          + "<td>"
		          + value["followUpPerson"]
		          + "</td>"
		          + "<td>"
		          + "<input type='checkbox' class='checkBoxClass' name='selectClients' value=" + value["email"]+">"          
		       + "</td></tr></tbody>"
		        });
		        table += "</table>"
		        table += "<div id='displayNumSelected'></div>"
		        table += "<div class='container' align='center'>"
		         + "<div class='inline'><button class='btn btn-default' onclick='sendEmail()'>Go to email template</button></div><div class='inline'><div  id='message'></div></div>"
		         + "<br> <button type='button' id='export' class='btn btn-link'><b>Export to excel(in progress)</b></button>"
		           +"</div>"
		       
		         $("#display").html(table);
		        
		    } 
		     

		   });
		 }
	
	
	function displayAll(){
		var table = "<table class='table table-list-search' class='display' cellspacing='0' >";
		console.log("displayALl");
		var isEmpty = false;
		$.ajax({
			url: "DisplayAll",
			type: "get",
		    dataType : "json",    
		    success: function(data){
		    	var json = jQuery.parseJSON(JSON.stringify(data));
		    	table += "<thead>"
		    			+ "<tr><th><button type='button' id='sort' class='btn btn-default btn-sm'>Starting Age</button></th>"
		    			+ "<th>Common Illness</th>"
		    			+ "<th>Screening </th>"
		    			+"<th>"
			    		+"<select  id='gender'>"
					    	+"<option value='Male'>Male</option>"
					    	+"<option value='Female'>Female</option>"
					    	+"<option value='' selected='selected' >All Gender Type</option>"
					    	+"</select>"
				    	+"</th>"
		    			+ "<th>Regularity of screening</th>"
		    			+ "<th>View Patients</th>"
		    			+ "<th>Edit</th>"
		    			+ "<th>Delete</th></tr></thead>";
		    	$.each(json,function(key, value) {
		    		table += "<tbody><tr><td>"
	    				+ value["ageRequired"]
	    				+ "</td>"
	    				+ "<td>"
	    				+ value["conditionName"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["screening"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["type"]
    					+ "</td>"
    					+ "<td>"
	    				+ value["years"] 
    					+ "</td>"
    					+ "<td>"
	    				+"<a href='#' onClick=viewPatientList(this.id) id= '"
	    				+ value.ID
	    				+ "'>View patients</a>"
    					+ "</td>"
    					+ "<td>"
	    				+ "<a href='#' onClick=editItem(this.id) id= '"
	    				+ value.ID
	    				+ "'>Edit</a>"
    					+ "</td>"
    					+ '<td><a href=# onClick=deleteItem(this.id) id="'
						+ value.ID
						+ '">Delete</a></td></tr>'		    				
						+ "</td></tr></tbody>"
		    	});
		    	table += "</table>"
		    		$("#display").html(table);
		    	
		    }	
		    
		});	
		}
		


	
	
		
 </script>
  </head>
  
  <body>
    
  	<div id="includedContent"></div>

	<div class="page-header"  align="center">
	  <h1><b>View Screenings - Adult</b></h1>
	  <div class="row">
	  <button type="button" class="btn btn-default"> <a href='addScreeningAdult.html'> Add new screening</a></button>
	  </div>
	  <div class="container" align = "center" id="search"></div>
	   	
	</div>

	<div class="container">
	<div class="btn-group btn-group-justified" role="group">
	  <div class="btn-group" role="group">
	    <button type="button" id="selectInfant" class="btn btn-default"><b>Infants (0-24 months)</b></button>
	  </div>
	  <div class="btn-group" role="group">
	    <button type="button" id="selectAdult" class="btn btn-primary"><b>Adults (2 years and above)</b></button>
	  </div>
	</div>
	</div>

	
	
	<div class="container" id="display" ></div>
	
	
	

  </body>
</html>
