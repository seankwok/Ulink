<!DOCTYPE html>




<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="ISO-8859-1">
	<title>Draft Email</title>
	 <link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery-1.12.0.js"></script>
	<script src="js/bootstrap.min.js"></script>
    <script> 
	    $(function(){
	      $("#includedContent").load("navBar.html"); 
	    });

    </script> 

	<style>
			.errorMsg {
			   font-size: 15px; 
			   text-align: center;
			}		
			


	</style>
	
	
	<script type="text/javascript">
	$(document).ready(function() {
		showDropdownList();

	
		document.getElementById("copyButton").addEventListener("click", function() {
		    copyToClipboardMsg(document.getElementById("copyTarget"), "msg");
		});
	
		document.getElementById("copyButton2").addEventListener("click", function() {
		    copyToClipboardMsg(document.getElementById("copyTarget2"), "msg");
		});
		
		document.getElementById("copyButton3").addEventListener("click", function() {
		    copyToClipboardMsg(document.getElementById("copyTarget3"), "msg");
		});
		
		document.getElementById("pasteTarget").addEventListener("mousedown", function() {
		    this.value = "";
		});
	
	});
	
	function copyToClipboardMsg(elem, msgElem) {
		  var succeed = copyToClipboard(elem);
	    var msg;
	    if (!succeed) {
	        msg = "Copy not supported or blocked.  Press Ctrl+c to copy."
	    } else {
	        msg = "Text copied to the clipboard."
	    }
	    if (typeof msgElem === "string") {
	        msgElem = document.getElementById(msgElem);
	    }
	    msgElem.innerHTML = msg;
	    setTimeout(function() {
	        msgElem.innerHTML = "";
	    }, 2000);
	}

	function copyToClipboard(elem) {
		  // create hidden text element, if it doesn't already exist
	    var targetId = "_hiddenCopyText_";
	    var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
	    var origSelectionStart, origSelectionEnd;
	    if (isInput) {
	        // can just use the original source element for the selection and copy
	        target = elem;
	        origSelectionStart = elem.selectionStart;
	        origSelectionEnd = elem.selectionEnd;
	    } else {
	        // must use a temporary form element for the selection and copy
	        target = document.getElementById(targetId);
	        if (!target) {
	            var target = document.createElement("textarea");
	            target.style.position = "absolute";
	            target.style.left = "-9999px";
	            target.style.top = "0";
	            target.id = targetId;
	            document.body.appendChild(target);
	        }
	        target.textContent = elem.textContent;
	    }
	    // select the content
	    var currentFocus = document.activeElement;
	    target.focus();
	    target.setSelectionRange(0, target.value.length);
	    
	    // copy the selection
	    var succeed;
	    try {
	    	  succeed = document.execCommand("copy");
	    } catch(e) {
	        succeed = false;
	    }
	    // restore original focus
	    if (currentFocus && typeof currentFocus.focus === "function") {
	        currentFocus.focus();
	    }
	    
	    if (isInput) {
	        // restore prior selection
	        elem.setSelectionRange(origSelectionStart, origSelectionEnd);
	    } else {
	        // clear temporary content
	        target.textContent = "";
	    }
	    return succeed;
	}

		function selectTemplate(clickedID){
			var sendData = {
					"templateName" : clickedID
				};
			console.log(clickedID);
	    	$.ajax({	    	
		    	url : "RetrieveEmailTemplate",
				type : "post",
				data : sendData,
				complete : function(data) {
					var frameContent = data.responseText;
			    	var doc = document.getElementById('iframe').contentWindow.document;
			    	doc.open();
			    	doc.write(frameContent);
			    	doc.close();
				}
			});
	
		}
	    
	    	    
	    function save(){
	    	var templateName = $('#template').val();
	    	if (templateName == ""){
	      		$('#errMsg').html("Template Name Required!");	 	    		  
	    	}else{
	    		
		    	var doc = document.getElementById('iframe').contentWindow.document;
		    	
		    	$.ajax({
					type: 'post',
					url: "CreateEmailTemplate",
					data: 'templateName=' + templateName
						+ '&'
						+ 'msg=' + doc,
					complete: function(data){		
					}
				});
		    	$('#exampleModal').modal('hide');
		    	$('#errMsg').html("");
	    	}
	    }	
	    
	    
	    function showDropdownList(){
	    	$.ajax({			    	
					type: 'post',
					url: "DisplayAllEmail",
					complete: function(data){
						var htmlDD = "<div class='dropdown'> "
					    	+ "<a id='drop1' href='#' role='button' class='btn btn-warning dropdown-toggle' data-toggle='dropdown'>Select Template<b class='caret'></b></a>"
					    	+ " <ul class='dropdown-menu' role='menu' aria-labelledby='dLabel'>"
						var json = jQuery.parseJSON(data.responseText);
					
						$.each(json, function(key, value){
							htmlDD += "<li><a tabindex='-1' href='#'onClick=selectTemplate(this.id) id='"+value+"'>"+value+"</a></li>"
						});
						 htmlDD += "</ul></div>"
						 $('#templateDropdown').html(htmlDD);
					}	    		  
	    	});	
	    }
	    
	    function getSelectionTextScreening(){
	        var selectedText = "<%screening>"
	        if (window.getSelection){ // all modern browsers and IE9+
	            selectedText = window.getSelection().toString()
	        }
	        return selectedText
	    }
		
	</script>
</head>


		
<body onload="enableEditMode();">
		<div id="includedContent"></div>
	<div class="page-header">
		<h1 align="center">New Email</h1>
	</div>
	<div align="left" >
		<div class='container'>
			<button onclick="execCmd('bold');"><b>B</b><i class="fa fa-bold"></i></button>
			<button onclick="execCmd('italic');"><i>I</i><i class="fa fa-italic"></i></button>
			<button onclick="execCmd('underline');">U<i class="fa fa-underline"></i></button>
			<button onclick="execCmd('justifyLeft');"> Left<i class="fa fa-align-left"></i></button>
			<button onclick="execCmd('justifyCenter');"> Center<i class="fa fa-align-center"></i></button>
			<button onclick="execCmd('justifyRight');"> Right<i class="fa fa-align-right"></i></button>
			<button onclick="execCmd('justifyFull');"> Full<i class="fa fa-align-justify"></i></button>
			<button onclick="execCmd('undo');">Undo<i class="fa fa-undo"></i></button>
			<button onclick="execCmd('redo');">Redo<i class="fa fa-repeat"></i></button>
			<button onclick="execCmd('insertUnorderedList');">Bullets<i class="fa fa-list-ul"></i></button>
			<button onclick="execCmd('insertOrderedList');">Number List<i class="fa fa-list-ol"></i></button>
			<select onchange="execCommandWithArg('fontName', this.value);">
				<option value="Arial">Arial</option>
				<option value="Comic Sans MS">Comic Sans MS</option>
				<option value="Courier">Courier</option>
				<option value="Georgia">Georgia</option>
				<option value="Tahoma">Tahoma</option>
				<option value="Times New Roman">Times New Roman</option>
				<option value="Verdana">Verdana</option>
			</select>
			<select onchange="execCommandWithArg('fontSize', this.value);">
				<option value="1">9</option>
				<option value="2">10</option>
				<option value="3">11</option>
				<option value="4" selected="selected">12</option>
				<option value="5">13</option>
				<option value="6">14</option>
				<option value="8">15</option>
				<option value="9">16</option>
				<option value="10">17</option>
				<option value="11">18</option>
			</select>
			Font Color: <input type="color" onchange="execCommandWithArg('foreColor', this.value);">
			<button onclick="execCmd('selectAll');">Select All</button>	
			
			<table >
			 <caption>Fields from Database:</caption>
				<tr> 
					<td><input id = 'copyTarget' type="text"  value="<%clientName>" readonly></td>
					<td><button id="copyButton">Copy</button></td>
					<td><input id = 'copyTarget2' type="text"  value="<%clientEmail>" readonly></td>
					<td><button id="copyButton2">Copy</button></td>
					<td><input  id = 'copyTarget3' type="text"  value="<%screening>" readonly></td>
					<td><button id="copyButton3">Copy</button></td>

					<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target='#exampleModal' >Save as Template</button></td>
					<td><div id='templateDropdown'></div></td>
				</tr>
			</table>
			<span id="msg"></span>
			<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h4 class="modal-title" id="exampleModalLabel"><b>Save Template As</b></h4>
			      </div>
			      <div class="modal-body">
			        <form>
			          <div class="form-group">
			            <label for="message-text" class="form-control-label">Template Name:</label>
			            <textarea class="form-control" id="template" ></textarea>
				            <div class="modal-footer">
				        		<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				        		<input type="button" class="btn btn-primary" onClick='save()' value='save'> 
				     		 </div>
			          </div>
			        </form>
			        <div id='errMsg' style='color:red' class='errorMsg'></div>
			        
			      </div>
			    </div>
			  </div>
			</div>	
		</div>
		<br>
	</div>				
		
		<br>
		<div class='container' >
			<iframe id="iframe" name="richTextField" style="width: 1000px; height: 500px;"></iframe>
			<br><div align='center'><button>Send to ...</button></div>
		</div>	

		<script type="text/javascript">

			var showingSourceCode = false;
			var isInEditMode = true;

			function enableEditMode () {
				richTextField.document.designMode = 'On';
			}

			function execCmd (command) {
				richTextField.document.execCommand(command, false, null);
			}

			function execCommandWithArg (command, arg) {
				richTextField.document.execCommand(command, false, arg);
			}


		</script>
		
	</body>
</html>